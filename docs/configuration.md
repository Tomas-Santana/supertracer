# Configuration

SuperTracer is highly configurable to suit different environments and requirements. Configuration can be provided via a `supertracer.config.json` file in your project root, or programmatically via the `SupertracerOptions` object.

## Structure

The configuration is divided into several sections:

- [Logger Options](#logger-options)
- [Metrics Options](#metrics-options)
- [UI Options](#ui-options)
- [Auth Options](#auth-options)
- [API Options](#api-options)
- [Retention Options](#retention-options)
- [Capture Options](#capture-options)

---

### Logger Options

Controls the internal logging behavior of SuperTracer.

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `level` | `int` | `20` (INFO) | The logging level (e.g., 10 for DEBUG, 20 for INFO). |
| `format` | `str` | `'%(message)s'` | The format string for log messages. |
| `datefmt` | `str` \| `null` | `null` | The date format string. |

### Metrics Options

Controls the collection and display of metrics in the dashboard.

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `enabled` | `bool` | `true` | Whether to collect metrics. |
| `history_limit` | `int` | `1000` | Maximum number of metric data points to keep in memory. |
| `refresh_interval` | `float` | `2.0` | Interval in seconds for refreshing metrics on the dashboard. |

### UI Options

Configuration for the NiceGUI-based dashboard.

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `mount_path` | `str` | `'/supertracer'` | The URL path where the dashboard will be mounted. |
| `page_size` | `int` | `20` | Number of logs to display per page in the logs table. |
| `storage_secret` | `str` \| `null` | `null` | Secret key for browser session storage encryption. |
| `storage_secret_env` | `str` \| `null` | `null` | Environment variable name to load the storage secret from. |

If both `storage_secret` and `storage_secret_env` are provided, the static value from `storage_secret` takes precedence.

### Auth Options

Controls access to the dashboard. For detailed authentication setup, see [Authentication](auth.md).

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `auth_enabled` | `bool` | `false` | Whether to enable authentication for the dashboard. |
| `username` | `str` \| `null` | `null` | Static username for login. |
| `password` | `str` \| `null` | `null` | Static password for login. |
| `username_env` | `str` \| `null` | `null` | Environment variable for username. |
| `password_env` | `str` \| `null` | `null` | Environment variable for password. |
| `auth_fn` | `Callable` | `null` | Custom authentication function (Programmatic only). |

If both static credentials and environment variable names are provided, the static values take precedence.

### API Options

Configuration for the SuperTracer REST API. For API usage details, see [API Reference](api.md).

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `base_path` | `str` | `'/supertracer-api'` | The base URL path for the API. |
| `api_enabled` | `bool` | `false` | Whether to enable the REST API. |
| `api_auth_enabled` | `bool` | `true` | Whether to require authentication for API access. |
| `api_key` | `str` \| `null` | `null` | Static API key. |
| `api_key_env` | `str` \| `null` | `null` | Environment variable for API key. |
| `api_auth_fn` | `Callable` | `null` | Custom API authentication function (Programmatic only). |

### Retention Options

Controls how long logs are kept in the database to manage storage size.

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `enabled` | `bool` | `false` | Whether to enable automatic log cleanup. |
| `max_records` | `int` | `10000` | Maximum number of logs to keep. Oldest logs are deleted first. |
| `cleanup_interval_minutes` | `int` | `30` | How often the cleanup task runs. |
| `cleanup_older_than_hours` | `int` | `24` | Delete logs older than this many hours. |

### Capture Options

Controls what data is captured from requests and responses.

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `capture_request_body` | `bool` | `true` | Whether to capture the request body. |
| `max_request_body_size` | `int` | `10240` | Maximum size (in bytes) of request body to capture. |
| `capture_response_body` | `bool` | `true` | Whether to capture the response body. |
| `max_response_body_size` | `int` | `10240` | Maximum size (in bytes) of response body to capture. |
| `save_own_traces` | `bool` | `false` | Whether to capture traces generated by SuperTracer itself (dashboard/API calls). |

## Example Usage

### Programmatic Configuration
```python
from supertracer import SuperTracer, SupertracerOptions, LoggerOptions, UIOptions, AuthOptions, RetentionOptions, ApiOptions

options = SupertracerOptions(
    logger_options=LoggerOptions(level=20),  # INFO
    ui_options=UIOptions(
        mount_path="/supertracer",
        storage_secret_env="SUPERTRACER_SECRET"
    ),
    auth_options=AuthOptions(
        auth_enabled=True,
        auth_fn=validate_credentials
    ),
    api_options=ApiOptions(
        api_enabled=True,
        api_auth_enabled=True,
        api_key_env="SUPERTRACER_API_KEY"
    ),
    retention_options=RetentionOptions(
        enabled=True,
        max_records=50000,
        cleanup_older_than_hours=48
    )
)

### `supertracer.config.json`

```json
{
  "logger_options": {
    "level": 20
  },
  "ui_options": {
    "mount_path": "/admin/logs",
    "storage_secret_env": "SUPERTRACER_SECRET"
  },
  "auth_options": {
    "auth_enabled": true,
    "username_env": "ADMIN_USER",
    "password_env": "ADMIN_PASS"
  },
  "retention_options": {
    "enabled": true,
    "max_records": 50000,
    "cleanup_older_than_hours": 48
  }
}
```


